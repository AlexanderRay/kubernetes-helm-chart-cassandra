# Set where Cassandra local data should be located
cassandraNodeSelector:
  node-role.kubernetes.io/node: "true"

# Number of nodes
cassandraReplicaCount: 3
# Number of maximum dead nodes
cassandraMaxUnavailableNodes: 1

# Cassandra settings
cassandraImageName: "quay.io/mysocialapp/cassandra"
cassandraImageVersion: "3.11.1-5"
cassandraDC: "DC1"
cassandraConfig:
  concurrentWrites: 128
  concurrentReads: 128
  concurrentCompactors: 2
  batchSizeWarnThresholdInKb: 64
  batchSizeFailThresholdInKb: 640
  compactionThroughputMbPerSec: 150
  heapNewSize: 256M
  hintedHandoffThrottleInKb: 4096
  maxHeap: 4G
  maxHintsDeliveryThreads: 4
  memtableAllocationType: "offheap_objects"
  memtableFlushWriter: 4
  memtableCleanupThreshold: 0.2
  rowCacheSizeInMb: 128
  rowCacheSavePeriod: 14400

# Backups
cassandraBackup:
  enableBackups: false
  backupSchedule: "0 3 * * *"
  backupImageVersion: v0.1
  awsAccessKeyId: "xxx"
  awsSecretAccessKey: "yyy"
  awsPassphrase: "zzz"
  awsBucket: "bucket_name"
  #duplicityOptions: "--archive-dir /var/lib/cassandra/.duplicity --allow-source-mismatch --s3-european-buckets --s3-use-new-style --copy-links --num-retries 3 --s3-use-multiprocessing --s3-multipart-chunk-size 100 --volsize 1024 full . s3://s3.amazonaws.com/cassandra-backups/$CLUSTER_DOMAIN/$CASSANDRA_CLUSTER_NAME/$(hostname)"
  awsDestinationPath: "s3://s3-eu-west-1.amazonaws.com/${AWS_BUCKET}/$CLUSTER_DOMAIN/$CASSANDRA_CLUSTER_NAME/$(hostname)"
  restoreFolder: "/var/lib/cassandra/restore"

# Cassandra Exporter
cassandraExporter:
  enabled: false
  replicaCount: 1
  imageVersion: 1.0.1
  nodeSelector:
    node-role.kubernetes.io/node: "true"
  config:
    host: cassandra:7199
    listenPort: 8080
cassandraPrometheusScrap: false